<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | New Unity Project</title>
  </head>
  <body style="text-align: center">
    <canvas id="unity-canvas" style="width: 100%; height: 600px; background: transparent"></canvas>
    <script src="Build/webGlBuild.loader.js"></script>
    <script>
      const eventCustom = new Event("build");
      var messagesFromShopify = new Array();
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/webGlBuild.data",
        frameworkUrl: "Build/webGlBuild.framework.js",
        codeUrl: "Build/webGlBuild.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "New Unity Project",
        productVersion: "0.1",
      }).then((unityInstance) => {
    window.unityInstance = unityInstance;
    console.log("Unity Instance", unityInstance);
    //document.dispatchEvent(eventCustom);
    for (let i = 0; i < messagesFromShopify.length; i++) {
        const messageType = messagesFromShopify[i];
        switch (messageType) {
            case "Map":
                window.unityInstance.SendMessage('stops', 'MapFromJs');
                break;
            case "InnerScreen":
                window.unityInstance.SendMessage('stops', 'InnerScreenFromJs');
                break;
            case "OuterScreen":
                window.unityInstance.SendMessage('stops', 'OuterScreenFromJs');
                break;
            case "InnerSideScreen":
                window.unityInstance.SendMessage('stops', 'InnerSideScreenFromJs');
                break;
            case "OuterSideScreen":
                window.unityInstance.SendMessage('stops', 'OuterSideScreenFromJs');
                break;
            case "BusSchedule":
                window.unityInstance.SendMessage('stops', 'BusScheduleFromJs');
                break;
            case "Silluete":
                window.unityInstance.SendMessage('stops', 'SillueteFromJs');
                break;
            // Add more cases for additional message types if needed
            default:
                // Handle unknown message types, if necessary
                break;
        }
    }
   });
    window.addEventListener("message", function(event) {
      if( window.unityInstance === undefined) {
        messagesFromShopify.push(event.data.type);
      }
      else
      {
         if (event.data.type === "Map") {       
          window.unityInstance.SendMessage('stops', 'MapFromJs');
         }
         if (event.data.type === "InnerScreen") {
            window.unityInstance.SendMessage('stops', 'InnerScreenFromJs');
         }
         if (event.data.type === "OuterScreen") {
            window.unityInstance.SendMessage('stops', 'OuterScreenFromJs');
         }
         if (event.data.type === "InnerSideScreen") {
            window.unityInstance.SendMessage('stops', 'InnerSideScreenFromJs');
         }
         if (event.data.type === "OuterSideScreen") {
            window.unityInstance.SendMessage('stops', 'OuterSideScreenFromJs');
         }
         if (event.data.type === "BusSchedule") {
            window.unityInstance.SendMessage('stops', 'BusScheduleFromJs');
         }
         if (event.data.type === "Silluete") {
            window.unityInstance.SendMessage('stops', 'SillueteFromJs');
         }
      }
     
   });
    </script>
  </body>
</html>
